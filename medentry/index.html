<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#2563EB">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>MedEntry - Bilan d'entr&eacute;e</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìã</text></svg>">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary: #2563EB;
            --primary-light: #3B82F6;
            --primary-lighter: #93C5FD;
            --primary-dark: #1D4ED8;
            --primary-glow: rgba(37, 99, 235, 0.25);

            --accent: #0D9488;
            --accent-light: #14B8A6;

            --success: #10B981;
            --success-bg: rgba(16, 185, 129, 0.12);
            --warning: #F59E0B;
            --warning-bg: rgba(245, 158, 11, 0.12);
            --danger: #EF4444;
            --danger-bg: rgba(239, 68, 68, 0.12);

            --bg-primary: #F8FAFC;
            --bg-secondary: #FFFFFF;
            --bg-tertiary: #F1F5F9;
            --bg-glass: rgba(255, 255, 255, 0.85);

            --text-primary: #0F172A;
            --text-secondary: #475569;
            --text-muted: #94A3B8;

            --border: rgba(0, 0, 0, 0.08);
            --border-light: rgba(0, 0, 0, 0.05);

            --shadow-sm: 0 1px 3px rgba(0,0,0,0.04), 0 1px 2px rgba(0,0,0,0.06);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.06), 0 2px 4px rgba(0,0,0,0.04);
            --shadow-lg: 0 12px 40px rgba(0,0,0,0.08), 0 4px 12px rgba(0,0,0,0.04);

            --radius-sm: 10px;
            --radius-md: 14px;
            --radius-lg: 18px;
            --radius-xl: 24px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            height: 100%;
            font-family: 'Plus Jakarta Sans', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            -webkit-font-smoothing: antialiased;
            overflow-x: hidden;
        }

        /* APP CONTAINER */
        .app-container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* HEADER */
        header {
            position: sticky;
            top: 0;
            z-index: 100;
            background: var(--bg-glass);
            backdrop-filter: blur(24px);
            -webkit-backdrop-filter: blur(24px);
            border-bottom: 1px solid var(--border-light);
            padding: 12px 20px 16px;
        }

        .header-top {
            display: flex;
            align-items: center;
            gap: 14px;
            margin-bottom: 16px;
        }

        .back-btn {
            width: 40px;
            height: 40px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
            color: var(--text-secondary);
            flex-shrink: 0;
        }

        .back-btn:hover {
            background: var(--bg-tertiary);
            color: var(--primary);
            transform: translateX(-2px);
        }

        .back-btn svg {
            width: 20px;
            height: 20px;
        }

        .logo {
            width: 44px;
            height: 44px;
            background: linear-gradient(145deg, var(--primary), var(--primary-dark));
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            box-shadow: var(--shadow-md), 0 0 40px var(--primary-glow);
        }

        .app-info {
            flex: 1;
        }

        .app-info h1 {
            font-size: 18px;
            font-weight: 800;
            letter-spacing: -0.3px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .app-info p {
            font-size: 12px;
            color: var(--text-muted);
            font-weight: 500;
        }

        /* PROGRESS BAR */
        .progress-container {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .progress-step {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            position: relative;
        }

        .progress-step::after {
            content: '';
            position: absolute;
            top: 14px;
            left: calc(50% + 16px);
            width: calc(100% - 32px);
            height: 3px;
            background: var(--border);
            border-radius: 2px;
        }

        .progress-step:last-child::after {
            display: none;
        }

        .progress-step.completed::after {
            background: var(--success);
        }

        .progress-step.active::after {
            background: linear-gradient(90deg, var(--primary) 50%, var(--border) 50%);
        }

        .step-circle {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: var(--bg-tertiary);
            border: 2px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 700;
            color: var(--text-muted);
            transition: all 0.3s ease;
            position: relative;
            z-index: 1;
        }

        .progress-step.active .step-circle {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
            box-shadow: 0 0 0 4px var(--primary-glow);
        }

        .progress-step.completed .step-circle {
            background: var(--success);
            border-color: var(--success);
            color: white;
        }

        .progress-step.completed .step-circle::before {
            content: '\2713';
        }

        .step-label {
            font-size: 10px;
            font-weight: 600;
            color: var(--text-muted);
            text-align: center;
            white-space: nowrap;
        }

        .progress-step.active .step-label {
            color: var(--primary);
        }

        .progress-step.completed .step-label {
            color: var(--success);
        }

        /* MAIN CONTENT */
        main {
            flex: 1;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
            width: 100%;
        }

        /* FORM STEPS */
        .form-step {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .form-step.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* SECTION CARD */
        .section-card {
            background: var(--bg-secondary);
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-light);
            box-shadow: var(--shadow-md);
            padding: 24px;
            margin-bottom: 20px;
        }

        .section-title {
            font-size: 16px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title-icon {
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, var(--primary-lighter), var(--primary-light));
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        /* FORM ELEMENTS */
        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            font-size: 13px;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 6px;
        }

        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: 12px 14px;
            font-size: 14px;
            font-family: inherit;
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            background: var(--bg-primary);
            color: var(--text-primary);
            transition: all 0.2s ease;
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px var(--primary-glow);
        }

        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        @media (max-width: 480px) {
            .form-row {
                grid-template-columns: 1fr;
            }
        }

        /* CHECKBOX GROUP */
        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 14px;
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 13px;
        }

        .checkbox-item:hover {
            border-color: var(--primary-light);
            background: var(--bg-tertiary);
        }

        .checkbox-item input {
            display: none;
        }

        .checkbox-item.checked {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
        }

        .checkbox-custom {
            width: 18px;
            height: 18px;
            border: 2px solid var(--border);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            flex-shrink: 0;
        }

        .checkbox-item.checked .checkbox-custom {
            background: white;
            border-color: white;
        }

        .checkbox-custom svg {
            width: 12px;
            height: 12px;
            opacity: 0;
            color: var(--primary);
        }

        .checkbox-item.checked .checkbox-custom svg {
            opacity: 1;
        }

        /* NAVIGATION BUTTONS */
        .nav-buttons {
            display: flex;
            gap: 12px;
            margin-top: 24px;
        }

        .btn {
            flex: 1;
            padding: 14px 24px;
            font-size: 14px;
            font-weight: 600;
            font-family: inherit;
            border: none;
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-secondary);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            background: var(--bg-primary);
            color: var(--text-primary);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            box-shadow: var(--shadow-md), 0 4px 12px var(--primary-glow);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg), 0 8px 20px var(--primary-glow);
        }

        .btn-primary:active {
            transform: translateY(0);
        }

        .btn svg {
            width: 18px;
            height: 18px;
        }

        /* SCORE CARD */
        .score-card {
            background: var(--bg-primary);
            border-radius: var(--radius-md);
            border: 1px solid var(--border);
            padding: 16px;
            margin-bottom: 16px;
        }

        .score-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .score-title {
            font-size: 14px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .score-value {
            font-size: 18px;
            font-weight: 800;
            color: var(--primary);
            background: var(--primary-glow);
            padding: 4px 12px;
            border-radius: 100px;
        }

        /* SYSTEM SECTION */
        .system-section {
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            margin-bottom: 12px;
            overflow: hidden;
        }

        .system-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px;
            background: var(--bg-tertiary);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .system-header:hover {
            background: var(--bg-primary);
        }

        .system-header h4 {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .system-header svg {
            width: 20px;
            height: 20px;
            color: var(--text-muted);
            transition: transform 0.2s ease;
        }

        .system-section.open .system-header svg {
            transform: rotate(180deg);
        }

        .system-content {
            display: none;
            padding: 16px;
            background: var(--bg-secondary);
        }

        .system-section.open .system-content {
            display: block;
        }

        /* RESULT SECTION */
        .result-section {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .result-section.active {
            display: block;
        }

        .result-card {
            background: var(--bg-secondary);
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-light);
            box-shadow: var(--shadow-lg);
            overflow: hidden;
        }

        .result-header {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 20px 24px;
        }

        .result-header h2 {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .result-header p {
            font-size: 13px;
            opacity: 0.9;
        }

        .result-content {
            padding: 24px;
        }

        .result-text {
            font-size: 14px;
            line-height: 1.7;
            color: var(--text-primary);
            white-space: pre-wrap;
        }

        .result-actions {
            display: flex;
            gap: 12px;
            padding: 16px 24px;
            border-top: 1px solid var(--border-light);
            background: var(--bg-tertiary);
        }

        /* LOADING */
        .loading-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(255,255,255,0.9);
            backdrop-filter: blur(8px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            gap: 16px;
        }

        .loading-overlay.active {
            display: flex;
        }

        .spinner {
            width: 48px;
            height: 48px;
            border: 4px solid var(--border);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-secondary);
        }

        /* RESPONSIVE */
        @media (max-width: 480px) {
            header {
                padding: 10px 16px 14px;
            }

            .header-top {
                margin-bottom: 12px;
            }

            .logo {
                width: 38px;
                height: 38px;
                font-size: 18px;
            }

            .app-info h1 {
                font-size: 16px;
            }

            .step-label {
                display: none;
            }

            main {
                padding: 16px;
            }

            .section-card {
                padding: 18px;
            }

            .nav-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- HEADER -->
        <header>
            <div class="header-top">
                <a href="../index.html" class="back-btn">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M19 12H5M12 19l-7-7 7-7"/>
                    </svg>
                </a>
                <div class="logo">üìã</div>
                <div class="app-info">
                    <h1>MedEntry</h1>
                    <p>Bilan d'entr&eacute;e g&eacute;riatrique</p>
                </div>
            </div>

            <!-- Progress Bar -->
            <div class="progress-container">
                <div class="progress-step active" data-step="1">
                    <div class="step-circle">1</div>
                    <span class="step-label">Identit&eacute;</span>
                </div>
                <div class="progress-step" data-step="2">
                    <div class="step-circle">2</div>
                    <span class="step-label">Anamn&egrave;se</span>
                </div>
                <div class="progress-step" data-step="3">
                    <div class="step-circle">3</div>
                    <span class="step-label">Status</span>
                </div>
                <div class="progress-step" data-step="4">
                    <div class="step-circle">4</div>
                    <span class="step-label">Scores</span>
                </div>
                <div class="progress-step" data-step="5">
                    <div class="step-circle">5</div>
                    <span class="step-label">Compl&eacute;ments</span>
                </div>
            </div>
        </header>

        <!-- MAIN CONTENT -->
        <main>
            <!-- Step 1: Identit√© -->
            <div class="form-step active" data-step="1">
                <div class="section-card">
                    <h3 class="section-title">
                        <span class="section-title-icon">üë§</span>
                        Identification du patient
                    </h3>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Nom</label>
                            <input type="text" class="form-input" id="patientNom" placeholder="Nom du patient">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Pr√©nom</label>
                            <input type="text" class="form-input" id="patientPrenom" placeholder="Pr√©nom du patient">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">√Çge</label>
                            <input type="number" class="form-input" id="patientAge" placeholder="√Çge" min="0" max="120">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Sexe</label>
                            <select class="form-select" id="patientSexe">
                                <option value="">S√©lectionner</option>
                                <option value="M">Homme</option>
                                <option value="F">Femme</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Date d'entr√©e</label>
                            <input type="date" class="form-input" id="dateEntree">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Provenance</label>
                            <select class="form-select" id="provenance">
                                <option value="">S√©lectionner</option>
                                <option value="domicile">Domicile</option>
                                <option value="urgences">Urgences</option>
                                <option value="transfert">Transfert autre service</option>
                                <option value="ems">EMS</option>
                                <option value="readaptation">R√©adaptation</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Motif d'hospitalisation</label>
                        <textarea class="form-textarea" id="motifHospitalisation" placeholder="D√©crivez le motif principal d'hospitalisation..."></textarea>
                    </div>

                    <div class="form-group">
                        <label class="form-label">M√©decin traitant</label>
                        <input type="text" class="form-input" id="medecinTraitant" placeholder="Dr. Nom Pr√©nom">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Ant√©c√©dents principaux</label>
                        <textarea class="form-textarea" id="antecedents" placeholder="Liste des comorbidit√©s principales..."></textarea>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Traitement habituel</label>
                        <textarea class="form-textarea" id="traitementHabituel" placeholder="M√©dicaments √† domicile..."></textarea>
                    </div>
                </div>

                <div class="nav-buttons">
                    <button class="btn btn-primary" onclick="nextStep()">
                        Suivant
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M5 12h14M12 5l7 7-7 7"/>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Step 2: Anamn√®se -->
            <div class="form-step" data-step="2">
                <div class="section-card">
                    <h3 class="section-title">
                        <span class="section-title-icon">üìù</span>
                        Anamn√®se par syst√®me
                    </h3>
                    <p style="font-size: 13px; color: var(--text-muted); margin-bottom: 16px;">
                        Cochez les sympt√¥mes <strong>pr√©sents</strong>. Les sympt√¥mes non coch√©s seront consid√©r√©s comme absents.
                    </p>

                    <!-- G√©n√©ral -->
                    <div class="system-section open">
                        <div class="system-header" onclick="toggleSystem(this)">
                            <h4>üå°Ô∏è G√©n√©ral</h4>
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 9l6 6 6-6"/></svg>
                        </div>
                        <div class="system-content">
                            <div class="checkbox-group">
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="anamnese_general" value="fatigue">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    Fatigue
                                </label>
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="anamnese_general" value="sudations_nocturnes">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    Sudations nocturnes
                                </label>
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="anamnese_general" value="trouble_sommeil">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    Trouble du sommeil
                                </label>
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="anamnese_general" value="perte_appetit">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    Perte d'app√©tit
                                </label>
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="anamnese_general" value="perte_poids">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    Perte de poids
                                </label>
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="anamnese_general" value="fievre">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    Fi√®vre
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Cardiovasculaire -->
                    <div class="system-section">
                        <div class="system-header" onclick="toggleSystem(this)">
                            <h4>‚ù§Ô∏è Cardiovasculaire</h4>
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 9l6 6 6-6"/></svg>
                        </div>
                        <div class="system-content">
                            <div class="checkbox-group">
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="anamnese_cv" value="drs">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    Douleur r√©trosternale
                                </label>
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="anamnese_cv" value="orthopnee">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    Orthopn√©e
                                </label>
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="anamnese_cv" value="dyspnee">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    Dyspn√©e d'effort
                                </label>
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="anamnese_cv" value="nycturie">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    Nycturie
                                </label>
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="anamnese_cv" value="omi">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    OMI
                                </label>
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="anamnese_cv" value="palpitations">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    Palpitations
                                </label>
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="anamnese_cv" value="claudication">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    Claudication
                                </label>
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="anamnese_cv" value="syncope">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    Syncope/lipothymie
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Respiratoire -->
                    <div class="system-section">
                        <div class="system-header" onclick="toggleSystem(this)">
                            <h4>ü´Å Respiratoire</h4>
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 9l6 6 6-6"/></svg>
                        </div>
                        <div class="system-content">
                            <div class="checkbox-group">
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="anamnese_resp" value="rhinorrhee">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    Rhinorrh√©e
                                </label>
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="anamnese_resp" value="maux_gorge">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    Maux de gorge
                                </label>
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="anamnese_resp" value="toux">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    Toux
                                </label>
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="anamnese_resp" value="expectorations">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    Expectorations
                                </label>
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="anamnese_resp" value="hemoptysie">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    H√©moptysie
                                </label>
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="anamnese_resp" value="dyspnee_repos">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    Dyspn√©e au repos
                                </label>
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="anamnese_resp" value="douleur_thoracique">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    Douleur thoracique respiro-d√©pendante
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Digestif -->
                    <div class="system-section">
                        <div class="system-header" onclick="toggleSystem(this)">
                            <h4>üçΩÔ∏è Digestif</h4>
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 9l6 6 6-6"/></svg>
                        </div>
                        <div class="system-content">
                            <div class="checkbox-group">
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="anamnese_dig" value="nausees">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    Naus√©es
                                </label>
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="anamnese_dig" value="vomissements">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    Vomissements
                                </label>
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="anamnese_dig" value="dysphagie">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    Dysphagie
                                </label>
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="anamnese_dig" value="hematemese">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    H√©mat√©m√®se
                                </label>
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="anamnese_dig" value="pyrosis">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    Pyrosis
                                </label>
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="anamnese_dig" value="douleurs_abdo">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    Douleurs abdominales
                                </label>
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="anamnese_dig" value="constipation">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    Constipation
                                </label>
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="anamnese_dig" value="diarrhee">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    Diarrh√©e
                                </label>
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="anamnese_dig" value="hematochezie">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    H√©matoch√©zie
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Urologique -->
                    <div class="system-section">
                        <div class="system-header" onclick="toggleSystem(this)">
                            <h4>üöø Urologique</h4>
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 9l6 6 6-6"/></svg>
                        </div>
                        <div class="system-content">
                            <div class="checkbox-group">
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="anamnese_uro" value="brulures">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    Br√ªlures mictionnelles
                                </label>
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="anamnese_uro" value="pollakiurie">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    Pollakiurie
                                </label>
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="anamnese_uro" value="polyurie">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    Polyurie
                                </label>
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="anamnese_uro" value="dysurie">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    Dysurie
                                </label>
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="anamnese_uro" value="hematurie">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    H√©maturie
                                </label>
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="anamnese_uro" value="incontinence">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    Incontinence urinaire
                                </label>
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="anamnese_uro" value="trouble_jet">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    Trouble du jet
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Ost√©o-articulaire -->
                    <div class="system-section">
                        <div class="system-header" onclick="toggleSystem(this)">
                            <h4>ü¶¥ Ost√©o-articulaire</h4>
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 9l6 6 6-6"/></svg>
                        </div>
                        <div class="system-content">
                            <div class="checkbox-group">
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="anamnese_oa" value="arthralgie">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    Arthralgies
                                </label>
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="anamnese_oa" value="tumefaction">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    Tum√©faction articulaire
                                </label>
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="anamnese_oa" value="douleur_rachis">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    Douleur rachidienne
                                </label>
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="anamnese_oa" value="raideur_matinale">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    Raideur matinale
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Cutan√© -->
                    <div class="system-section">
                        <div class="system-header" onclick="toggleSystem(this)">
                            <h4>ü©π Cutan√©</h4>
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 9l6 6 6-6"/></svg>
                        </div>
                        <div class="system-content">
                            <div class="checkbox-group">
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="anamnese_cut" value="lesion">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    L√©sion cutan√©e
                                </label>
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="anamnese_cut" value="eruption">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    √âruption cutan√©e
                                </label>
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="anamnese_cut" value="prurit">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    Prurit
                                </label>
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="anamnese_cut" value="escarre">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    Escarre
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Neurologique -->
                    <div class="system-section">
                        <div class="system-header" onclick="toggleSystem(this)">
                            <h4>üß† Neurologique</h4>
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 9l6 6 6-6"/></svg>
                        </div>
                        <div class="system-content">
                            <div class="checkbox-group">
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="anamnese_neuro" value="trouble_vision">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    Trouble de la vision
                                </label>
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="anamnese_neuro" value="trouble_audition">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    Trouble de l'audition
                                </label>
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="anamnese_neuro" value="cephalees">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    C√©phal√©es
                                </label>
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="anamnese_neuro" value="vertiges">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    Vertiges
                                </label>
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="anamnese_neuro" value="paresthesie">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    Paresth√©sies
                                </label>
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="anamnese_neuro" value="paresie">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    Par√©sie
                                </label>
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="anamnese_neuro" value="chutes">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    Chutes
                                </label>
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="anamnese_neuro" value="trouble_memoire">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    Troubles de m√©moire
                                </label>
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="anamnese_neuro" value="confusion">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    Confusion
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Remarques anamn√®se -->
                    <div class="form-group" style="margin-top: 16px;">
                        <label class="form-label">Remarques compl√©mentaires (anamn√®se)</label>
                        <textarea class="form-textarea" id="anamneseRemarques" placeholder="D√©tails suppl√©mentaires sur l'anamn√®se..."></textarea>
                    </div>
                </div>

                <div class="nav-buttons">
                    <button class="btn btn-secondary" onclick="prevStep()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M19 12H5M12 19l-7-7 7-7"/>
                        </svg>
                        Pr√©c√©dent
                    </button>
                    <button class="btn btn-primary" onclick="nextStep()">
                        Suivant
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M5 12h14M12 5l7 7-7 7"/>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Step 3: Status clinique -->
            <div class="form-step" data-step="3">
                <!-- Constantes vitales -->
                <div class="section-card">
                    <h3 class="section-title">
                        <span class="section-title-icon">üìä</span>
                        Constantes vitales
                    </h3>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">TA systolique (mmHg)</label>
                            <input type="number" class="form-input" id="taSystolique" placeholder="120" min="60" max="250">
                        </div>
                        <div class="form-group">
                            <label class="form-label">TA diastolique (mmHg)</label>
                            <input type="number" class="form-input" id="taDiastolique" placeholder="80" min="30" max="150">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">FC (bpm)</label>
                            <input type="number" class="form-input" id="fc" placeholder="75" min="30" max="220">
                        </div>
                        <div class="form-group">
                            <label class="form-label">SpO2 (%)</label>
                            <input type="number" class="form-input" id="spo2" placeholder="98" min="50" max="100">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Temp√©rature (¬∞C)</label>
                            <input type="number" class="form-input" id="temperature" placeholder="36.5" min="34" max="42" step="0.1">
                        </div>
                        <div class="form-group">
                            <label class="form-label">GCS (/15)</label>
                            <select class="form-select" id="gcs">
                                <option value="">S√©lectionner</option>
                                <option value="15">15 - Normal</option>
                                <option value="14">14</option>
                                <option value="13">13</option>
                                <option value="12">12</option>
                                <option value="11">11</option>
                                <option value="10">10</option>
                                <option value="9">9</option>
                                <option value="8">8</option>
                                <option value="7">7</option>
                                <option value="6">6</option>
                                <option value="5">5</option>
                                <option value="4">4</option>
                                <option value="3">3 - Coma profond</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Poids (kg)</label>
                            <input type="number" class="form-input" id="poids" placeholder="70" min="20" max="250" step="0.1">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Taille (cm)</label>
                            <input type="number" class="form-input" id="taille" placeholder="170" min="100" max="220">
                        </div>
                    </div>
                </div>

                <!-- Examen par syst√®me -->
                <div class="section-card">
                    <h3 class="section-title">
                        <span class="section-title-icon">ü©∫</span>
                        Examen clinique par syst√®me
                    </h3>
                    <p style="font-size: 13px; color: var(--text-muted); margin-bottom: 16px;">
                        Cochez les anomalies <strong>pr√©sentes</strong>. Les √©l√©ments non coch√©s seront consid√©r√©s comme normaux.
                    </p>

                    <!-- G√©n√©ral -->
                    <div class="system-section open">
                        <div class="system-header" onclick="toggleSystem(this)">
                            <h4>üå°Ô∏è √âtat g√©n√©ral</h4>
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 9l6 6 6-6"/></svg>
                        </div>
                        <div class="system-content">
                            <div class="checkbox-group">
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="status_general" value="altere">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    √âtat g√©n√©ral alt√©r√©
                                </label>
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="status_general" value="febrile">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    F√©brile
                                </label>
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="status_general" value="algique">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    Algique
                                </label>
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="status_general" value="ictere">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    Ict√®re
                                </label>
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="status_general" value="cyanose">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    Cyanose
                                </label>
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="status_general" value="paleur">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    P√¢leur
                                </label>
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="status_general" value="deshydratation">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    D√©shydratation
                                </label>
                            </div>
                            <div class="form-group" style="margin-top: 12px;">
                                <input type="text" class="form-input" id="statusGeneralDetails" placeholder="Pr√©cisions...">
                            </div>
                        </div>
                    </div>

                    <!-- Cardiovasculaire -->
                    <div class="system-section">
                        <div class="system-header" onclick="toggleSystem(this)">
                            <h4>‚ù§Ô∏è Cardiovasculaire</h4>
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 9l6 6 6-6"/></svg>
                        </div>
                        <div class="system-content">
                            <div class="checkbox-group">
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="status_cv" value="souffle">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    Souffle cardiaque
                                </label>
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="status_cv" value="arythmie">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    Arythmie
                                </label>
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="status_cv" value="turgescence">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    Turgescence jugulaire
                                </label>
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="status_cv" value="rhj">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    Reflux h√©pato-jugulaire
                                </label>
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="status_cv" value="omi">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    OMI
                                </label>
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="status_cv" value="mollets_douloureux">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    Mollets douloureux
                                </label>
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="status_cv" value="homans_positif">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    Homans positif
                                </label>
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="status_cv" value="pouls_absents">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    Pouls p√©riph. absents
                                </label>
                            </div>
                            <div class="form-group" style="margin-top: 12px;">
                                <input type="text" class="form-input" id="statusCvDetails" placeholder="Pr√©cisions (localisation OMI, TRC...)">
                            </div>
                        </div>
                    </div>

                    <!-- Respiratoire -->
                    <div class="system-section">
                        <div class="system-header" onclick="toggleSystem(this)">
                            <h4>ü´Å Respiratoire</h4>
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 9l6 6 6-6"/></svg>
                        </div>
                        <div class="system-content">
                            <div class="checkbox-group">
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="status_resp" value="detresse">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    D√©tresse respiratoire
                                </label>
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="status_resp" value="tirage">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    Tirage
                                </label>
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="status_resp" value="asymetrie">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    Asym√©trie auscultatoire
                                </label>
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="status_resp" value="cr√©pitants">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    Cr√©pitants
                                </label>
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="status_resp" value="sibilants">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    Sibilants
                                </label>
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="status_resp" value="ronchi">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    Ronchi
                                </label>
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="status_resp" value="silence">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    Silence auscultatoire
                                </label>
                            </div>
                            <div class="form-group" style="margin-top: 12px;">
                                <input type="text" class="form-input" id="statusRespDetails" placeholder="Pr√©cisions (localisation, O2...)">
                            </div>
                        </div>
                    </div>

                    <!-- Digestif -->
                    <div class="system-section">
                        <div class="system-header" onclick="toggleSystem(this)">
                            <h4>üçΩÔ∏è Digestif</h4>
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 9l6 6 6-6"/></svg>
                        </div>
                        <div class="system-content">
                            <div class="checkbox-group">
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="status_dig" value="douleur">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    Douleur abdominale
                                </label>
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="status_dig" value="defense">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    D√©fense
                                </label>
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="status_dig" value="detente">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    D√©tente
                                </label>
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="status_dig" value="murphy">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    Murphy positif
                                </label>
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="status_dig" value="mcburney">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    McBurney positif
                                </label>
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="status_dig" value="hepatomegalie">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    H√©patom√©galie
                                </label>
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="status_dig" value="splenomegalie">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    Spl√©nom√©galie
                                </label>
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="status_dig" value="ascite">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    Ascite
                                </label>
                            </div>
                            <div class="form-group" style="margin-top: 12px;">
                                <input type="text" class="form-input" id="statusDigDetails" placeholder="Pr√©cisions (localisation douleur, BHA...)">
                            </div>
                        </div>
                    </div>

                    <!-- Neurologique -->
                    <div class="system-section">
                        <div class="system-header" onclick="toggleSystem(this)">
                            <h4>üß† Neurologique</h4>
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 9l6 6 6-6"/></svg>
                        </div>
                        <div class="system-content">
                            <div class="checkbox-group">
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="status_neuro" value="desorientation">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    D√©sorientation
                                </label>
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="status_neuro" value="aphasie">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    Aphasie
                                </label>
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="status_neuro" value="dysarthrie">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    Dysarthrie
                                </label>
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="status_neuro" value="anisocorie">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    Anisocorie
                                </label>
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="status_neuro" value="nystagmus">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    Nystagmus
                                </label>
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="status_neuro" value="raideur_nuque">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    Raideur de nuque
                                </label>
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="status_neuro" value="deficit_sensitif">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    D√©ficit sensitif
                                </label>
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="status_neuro" value="deficit_moteur">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    D√©ficit moteur
                                </label>
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="status_neuro" value="babinski">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    Babinski positif
                                </label>
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="status_neuro" value="ataxie">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    Ataxie
                                </label>
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="status_neuro" value="romberg_negatif">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    Romberg non tenu
                                </label>
                            </div>
                            <div class="form-group" style="margin-top: 12px;">
                                <input type="text" class="form-input" id="statusNeuroDetails" placeholder="Pr√©cisions (force musculaire, ROTs...)">
                            </div>
                        </div>
                    </div>

                    <!-- Cutan√© -->
                    <div class="system-section">
                        <div class="system-header" onclick="toggleSystem(this)">
                            <h4>ü©π Cutan√©</h4>
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 9l6 6 6-6"/></svg>
                        </div>
                        <div class="system-content">
                            <div class="checkbox-group">
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="status_cut" value="escarre">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    Escarre
                                </label>
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="status_cut" value="ulcere">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    Ulc√®re
                                </label>
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="status_cut" value="erytheme">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    √âryth√®me
                                </label>
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="status_cut" value="hematome">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    H√©matome
                                </label>
                                <label class="checkbox-item" onclick="toggleCheckbox(event, this)">
                                    <input type="checkbox" name="status_cut" value="plaie">
                                    <span class="checkbox-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
                                    Plaie
                                </label>
                            </div>
                            <div class="form-group" style="margin-top: 12px;">
                                <input type="text" class="form-input" id="statusCutDetails" placeholder="Pr√©cisions (localisation, stade escarre...)">
                            </div>
                        </div>
                    </div>

                    <!-- Remarques status -->
                    <div class="form-group" style="margin-top: 16px;">
                        <label class="form-label">Remarques compl√©mentaires (examen clinique)</label>
                        <textarea class="form-textarea" id="statusRemarques" placeholder="Autres observations cliniques..."></textarea>
                    </div>
                </div>

                <div class="nav-buttons">
                    <button class="btn btn-secondary" onclick="prevStep()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M19 12H5M12 19l-7-7 7-7"/>
                        </svg>
                        Pr√©c√©dent
                    </button>
                    <button class="btn btn-primary" onclick="nextStep()">
                        Suivant
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M5 12h14M12 5l7 7-7 7"/>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Step 4: Scores g√©riatriques -->
            <div class="form-step" data-step="4">
                <!-- Mini-MNA -->
                <div class="section-card">
                    <h3 class="section-title">
                        <span class="section-title-icon">üçΩÔ∏è</span>
                        Mini-MNA (D√©pistage nutritionnel)
                    </h3>

                    <div class="score-card">
                        <div class="score-header">
                            <span class="score-title">Score Mini-MNA</span>
                            <span class="score-value" id="mnaTotalDisplay">--/14</span>
                        </div>

                        <div class="form-group">
                            <label class="form-label">A. Perte d'app√©tit ces 3 derniers mois ?</label>
                            <select class="form-select mna-item" data-score="mna" onchange="calculateMNA()">
                                <option value="">S√©lectionner</option>
                                <option value="0">Anorexie s√©v√®re (0)</option>
                                <option value="1">Anorexie mod√©r√©e (1)</option>
                                <option value="2">Pas d'anorexie (2)</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">B. Perte de poids ces 3 derniers mois ?</label>
                            <select class="form-select mna-item" data-score="mna" onchange="calculateMNA()">
                                <option value="">S√©lectionner</option>
                                <option value="0">Perte > 3 kg (0)</option>
                                <option value="1">Ne sait pas (1)</option>
                                <option value="2">Perte 1-3 kg (2)</option>
                                <option value="3">Pas de perte (3)</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">C. Mobilit√©</label>
                            <select class="form-select mna-item" data-score="mna" onchange="calculateMNA()">
                                <option value="">S√©lectionner</option>
                                <option value="0">Lit/fauteuil (0)</option>
                                <option value="1">Autonome √† l'int√©rieur (1)</option>
                                <option value="2">Sort du domicile (2)</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">D. Maladie aigu√´ ou stress psychologique ces 3 mois ?</label>
                            <select class="form-select mna-item" data-score="mna" onchange="calculateMNA()">
                                <option value="">S√©lectionner</option>
                                <option value="0">Oui (0)</option>
                                <option value="2">Non (2)</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">E. Probl√®mes neuropsychologiques</label>
                            <select class="form-select mna-item" data-score="mna" onchange="calculateMNA()">
                                <option value="">S√©lectionner</option>
                                <option value="0">D√©mence ou d√©pression s√©v√®re (0)</option>
                                <option value="1">D√©mence l√©g√®re (1)</option>
                                <option value="2">Pas de probl√®me (2)</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">F. IMC (kg/m¬≤)</label>
                            <select class="form-select mna-item" data-score="mna" onchange="calculateMNA()">
                                <option value="">S√©lectionner</option>
                                <option value="0">IMC < 19 (0)</option>
                                <option value="1">19 ‚â§ IMC < 21 (1)</option>
                                <option value="2">21 ‚â§ IMC < 23 (2)</option>
                                <option value="3">IMC ‚â• 23 (3)</option>
                            </select>
                        </div>

                        <div class="score-interpretation" id="mnaInterpretation" style="margin-top: 12px; padding: 10px; border-radius: 8px; font-size: 13px; font-weight: 600;"></div>
                    </div>
                </div>

                <!-- MoCA -->
                <div class="section-card">
                    <h3 class="section-title">
                        <span class="section-title-icon">üß†</span>
                        MoCA (√âvaluation cognitive)
                    </h3>

                    <div class="score-card">
                        <div class="score-header">
                            <span class="score-title">Score MoCA</span>
                            <span class="score-value" id="mocaTotalDisplay">--/30</span>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Score MoCA total (0-30)</label>
                            <input type="number" class="form-input" id="mocaScore" min="0" max="30" placeholder="Entrez le score" onchange="calculateMoCA()">
                        </div>

                        <div class="form-group">
                            <label class="form-label">Niveau d'√©ducation ‚â§ 12 ans ?</label>
                            <select class="form-select" id="mocaEducation" onchange="calculateMoCA()">
                                <option value="">S√©lectionner</option>
                                <option value="1">Oui (+1 point)</option>
                                <option value="0">Non</option>
                            </select>
                        </div>

                        <div class="score-interpretation" id="mocaInterpretation" style="margin-top: 12px; padding: 10px; border-radius: 8px; font-size: 13px; font-weight: 600;"></div>
                    </div>
                </div>

                <!-- Mini-GDS -->
                <div class="section-card">
                    <h3 class="section-title">
                        <span class="section-title-icon">üòî</span>
                        Mini-GDS (D√©pression)
                    </h3>

                    <div class="score-card">
                        <div class="score-header">
                            <span class="score-title">Score Mini-GDS</span>
                            <span class="score-value" id="gdsTotalDisplay">--/4</span>
                        </div>

                        <div class="form-group">
                            <label class="form-label">1. Vous sentez-vous souvent d√©courag√©(e) et triste ?</label>
                            <select class="form-select gds-item" onchange="calculateGDS()">
                                <option value="">S√©lectionner</option>
                                <option value="1">Oui (1)</option>
                                <option value="0">Non (0)</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">2. Avez-vous le sentiment que votre vie est vide ?</label>
                            <select class="form-select gds-item" onchange="calculateGDS()">
                                <option value="">S√©lectionner</option>
                                <option value="1">Oui (1)</option>
                                <option value="0">Non (0)</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">3. √ätes-vous heureux(se) la plupart du temps ?</label>
                            <select class="form-select gds-item" onchange="calculateGDS()">
                                <option value="">S√©lectionner</option>
                                <option value="0">Oui (0)</option>
                                <option value="1">Non (1)</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">4. Avez-vous l'impression que votre situation est d√©sesp√©r√©e ?</label>
                            <select class="form-select gds-item" onchange="calculateGDS()">
                                <option value="">S√©lectionner</option>
                                <option value="1">Oui (1)</option>
                                <option value="0">Non (0)</option>
                            </select>
                        </div>

                        <div class="score-interpretation" id="gdsInterpretation" style="margin-top: 12px; padding: 10px; border-radius: 8px; font-size: 13px; font-weight: 600;"></div>
                    </div>
                </div>

                <!-- ADL -->
                <div class="section-card">
                    <h3 class="section-title">
                        <span class="section-title-icon">üö∂</span>
                        ADL de Katz (Activit√©s de base)
                    </h3>

                    <div class="score-card">
                        <div class="score-header">
                            <span class="score-title">Score ADL</span>
                            <span class="score-value" id="adlTotalDisplay">--/6</span>
                        </div>

                        <div class="form-group">
                            <label class="form-label">1. Hygi√®ne corporelle (toilette)</label>
                            <select class="form-select adl-item" onchange="calculateADL()">
                                <option value="">S√©lectionner</option>
                                <option value="1">Autonome (1)</option>
                                <option value="0">Aide partielle ou totale (0)</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">2. Habillage</label>
                            <select class="form-select adl-item" onchange="calculateADL()">
                                <option value="">S√©lectionner</option>
                                <option value="1">Autonome (1)</option>
                                <option value="0">Aide partielle ou totale (0)</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">3. Aller aux toilettes</label>
                            <select class="form-select adl-item" onchange="calculateADL()">
                                <option value="">S√©lectionner</option>
                                <option value="1">Autonome (1)</option>
                                <option value="0">Aide partielle ou totale (0)</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">4. Locomotion / Transferts</label>
                            <select class="form-select adl-item" onchange="calculateADL()">
                                <option value="">S√©lectionner</option>
                                <option value="1">Autonome (1)</option>
                                <option value="0">Aide partielle ou totale (0)</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">5. Continence</label>
                            <select class="form-select adl-item" onchange="calculateADL()">
                                <option value="">S√©lectionner</option>
                                <option value="1">Continent (1)</option>
                                <option value="0">Incontinence partielle ou totale (0)</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">6. Alimentation</label>
                            <select class="form-select adl-item" onchange="calculateADL()">
                                <option value="">S√©lectionner</option>
                                <option value="1">Autonome (1)</option>
                                <option value="0">Aide partielle ou totale (0)</option>
                            </select>
                        </div>

                        <div class="score-interpretation" id="adlInterpretation" style="margin-top: 12px; padding: 10px; border-radius: 8px; font-size: 13px; font-weight: 600;"></div>
                    </div>
                </div>

                <!-- IADL -->
                <div class="section-card">
                    <h3 class="section-title">
                        <span class="section-title-icon">üè†</span>
                        IADL de Lawton (Activit√©s instrumentales)
                    </h3>

                    <div class="score-card">
                        <div class="score-header">
                            <span class="score-title">Score IADL</span>
                            <span class="score-value" id="iadlTotalDisplay">--/8</span>
                        </div>

                        <div class="form-group">
                            <label class="form-label">1. T√©l√©phone</label>
                            <select class="form-select iadl-item" onchange="calculateIADL()">
                                <option value="">S√©lectionner</option>
                                <option value="1">Utilise seul (1)</option>
                                <option value="0">Incapable ou aide n√©cessaire (0)</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">2. Courses</label>
                            <select class="form-select iadl-item" onchange="calculateIADL()">
                                <option value="">S√©lectionner</option>
                                <option value="1">Fait seul (1)</option>
                                <option value="0">Incapable ou aide n√©cessaire (0)</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">3. Pr√©paration des repas</label>
                            <select class="form-select iadl-item" onchange="calculateIADL()">
                                <option value="">S√©lectionner</option>
                                <option value="1">Pr√©pare seul (1)</option>
                                <option value="0">Incapable ou aide n√©cessaire (0)</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">4. Entretien m√©nager</label>
                            <select class="form-select iadl-item" onchange="calculateIADL()">
                                <option value="">S√©lectionner</option>
                                <option value="1">Fait seul (1)</option>
                                <option value="0">Incapable ou aide n√©cessaire (0)</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">5. Lessive</label>
                            <select class="form-select iadl-item" onchange="calculateIADL()">
                                <option value="">S√©lectionner</option>
                                <option value="1">Fait seul (1)</option>
                                <option value="0">Incapable ou aide n√©cessaire (0)</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">6. Transport</label>
                            <select class="form-select iadl-item" onchange="calculateIADL()">
                                <option value="">S√©lectionner</option>
                                <option value="1">Autonome (1)</option>
                                <option value="0">Incapable ou aide n√©cessaire (0)</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">7. M√©dicaments</label>
                            <select class="form-select iadl-item" onchange="calculateIADL()">
                                <option value="">S√©lectionner</option>
                                <option value="1">G√®re seul (1)</option>
                                <option value="0">Incapable ou aide n√©cessaire (0)</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">8. Finances</label>
                            <select class="form-select iadl-item" onchange="calculateIADL()">
                                <option value="">S√©lectionner</option>
                                <option value="1">G√®re seul (1)</option>
                                <option value="0">Incapable ou aide n√©cessaire (0)</option>
                            </select>
                        </div>

                        <div class="score-interpretation" id="iadlInterpretation" style="margin-top: 12px; padding: 10px; border-radius: 8px; font-size: 13px; font-weight: 600;"></div>
                    </div>
                </div>

                <div class="nav-buttons">
                    <button class="btn btn-secondary" onclick="prevStep()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M19 12H5M12 19l-7-7 7-7"/>
                        </svg>
                        Pr√©c√©dent
                    </button>
                    <button class="btn btn-primary" onclick="nextStep()">
                        Suivant
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M5 12h14M12 5l7 7-7 7"/>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Step 5: Compl√©ments -->
            <div class="form-step" data-step="5">
                <!-- R√©sum√© des scores -->
                <div class="section-card">
                    <h3 class="section-title">
                        <span class="section-title-icon">üìä</span>
                        R√©sum√© des scores
                    </h3>

                    <div class="scores-summary" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 12px;">
                        <div class="summary-item" style="background: var(--bg-tertiary); padding: 12px; border-radius: var(--radius-sm); text-align: center;">
                            <div style="font-size: 11px; color: var(--text-muted); margin-bottom: 4px;">Mini-MNA</div>
                            <div style="font-size: 18px; font-weight: 700; color: var(--primary);" id="summaryMNA">--/14</div>
                        </div>
                        <div class="summary-item" style="background: var(--bg-tertiary); padding: 12px; border-radius: var(--radius-sm); text-align: center;">
                            <div style="font-size: 11px; color: var(--text-muted); margin-bottom: 4px;">MoCA</div>
                            <div style="font-size: 18px; font-weight: 700; color: var(--primary);" id="summaryMoCA">--/30</div>
                        </div>
                        <div class="summary-item" style="background: var(--bg-tertiary); padding: 12px; border-radius: var(--radius-sm); text-align: center;">
                            <div style="font-size: 11px; color: var(--text-muted); margin-bottom: 4px;">Mini-GDS</div>
                            <div style="font-size: 18px; font-weight: 700; color: var(--primary);" id="summaryGDS">--/4</div>
                        </div>
                        <div class="summary-item" style="background: var(--bg-tertiary); padding: 12px; border-radius: var(--radius-sm); text-align: center;">
                            <div style="font-size: 11px; color: var(--text-muted); margin-bottom: 4px;">ADL</div>
                            <div style="font-size: 18px; font-weight: 700; color: var(--primary);" id="summaryADL">--/6</div>
                        </div>
                        <div class="summary-item" style="background: var(--bg-tertiary); padding: 12px; border-radius: var(--radius-sm); text-align: center;">
                            <div style="font-size: 11px; color: var(--text-muted); margin-bottom: 4px;">IADL</div>
                            <div style="font-size: 18px; font-weight: 700; color: var(--primary);" id="summaryIADL">--/8</div>
                        </div>
                    </div>
                </div>

                <!-- Informations compl√©mentaires -->
                <div class="section-card">
                    <h3 class="section-title">
                        <span class="section-title-icon">üìé</span>
                        Informations compl√©mentaires
                    </h3>

                    <div class="form-group">
                        <label class="form-label">Situation sociale</label>
                        <textarea class="form-textarea" id="situationSociale" placeholder="Vit seul(e), mari√©(e), veuf(ve), aide √† domicile, entourage familial..."></textarea>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Mode de vie / Habitat</label>
                        <textarea class="form-textarea" id="modeVie" placeholder="Maison, appartement, √©tages, escaliers, aides techniques..."></textarea>
                    </div>

                    <div class="form-group">
                        <label class="form-label">R√©sultats de laboratoire √† l'entr√©e</label>
                        <textarea class="form-textarea" id="laboEntree" placeholder="Hb, leucocytes, plaquettes, CRP, cr√©atinine, Na, K, glyc√©mie..."></textarea>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Examens compl√©mentaires</label>
                        <textarea class="form-textarea" id="examensComplementaires" placeholder="ECG, Rx thorax, CT, √©chographie..."></textarea>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Objectifs du s√©jour</label>
                        <textarea class="form-textarea" id="objectifss√©jour" placeholder="Bilan g√©riatrique, r√©adaptation, optimisation th√©rapeutique..."></textarea>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Autres remarques</label>
                        <textarea class="form-textarea" id="autresRemarques" placeholder="Toute information compl√©mentaire pertinente..."></textarea>
                    </div>
                </div>

                <div class="nav-buttons">
                    <button class="btn btn-secondary" onclick="prevStep()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M19 12H5M12 19l-7-7 7-7"/>
                        </svg>
                        Pr√©c√©dent
                    </button>
                    <button class="btn btn-primary" onclick="generateLetter()" style="background: linear-gradient(135deg, var(--success), #059669);">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14 2 14 8 20 8"/>
                            <line x1="16" y1="13" x2="8" y2="13"/>
                            <line x1="16" y1="17" x2="8" y2="17"/>
                        </svg>
                        G√©n√©rer lettre d'entr√©e
                    </button>
                </div>
            </div>

            <!-- Result Section -->
            <div class="result-section" id="resultSection">
                <div class="result-card">
                    <div class="result-header">
                        <h2>Lettre d'entr&eacute;e g&eacute;n&eacute;r&eacute;e</h2>
                        <p>Bilan g&eacute;riatrique complet</p>
                    </div>
                    <div class="result-content">
                        <div class="result-text" id="resultText"></div>
                    </div>
                    <div class="result-actions">
                        <button class="btn btn-secondary" onclick="copyResult()">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
                            </svg>
                            Copier
                        </button>
                        <button class="btn btn-primary" onclick="resetForm()">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
                                <path d="M3 3v5h5"/>
                            </svg>
                            Nouveau bilan
                        </button>
                    </div>
                </div>
            </div>
        </main>

        <!-- Loading Overlay -->
        <div class="loading-overlay" id="loadingOverlay">
            <div class="spinner"></div>
            <span class="loading-text">G&eacute;n&eacute;ration en cours...</span>
        </div>
    </div>

    <script>
        // ==========================================
        // MEDENTRY - Navigation & Core Functions
        // ==========================================

        let currentStep = 1;
        const totalSteps = 5;

        // Navigation entre les √©tapes
        function goToStep(step) {
            if (step < 1 || step > totalSteps) return;

            // Update current step
            currentStep = step;

            // Update scores summary when arriving at step 5
            if (step === 5) {
                updateScoresSummary();
            }

            // Update form steps visibility
            document.querySelectorAll('.form-step').forEach(el => {
                el.classList.remove('active');
            });
            document.querySelector(`.form-step[data-step="${step}"]`).classList.add('active');

            // Update progress bar
            document.querySelectorAll('.progress-step').forEach(el => {
                const stepNum = parseInt(el.dataset.step);
                el.classList.remove('active', 'completed');
                if (stepNum < step) {
                    el.classList.add('completed');
                } else if (stepNum === step) {
                    el.classList.add('active');
                }
            });

            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function nextStep() {
            if (currentStep < totalSteps) {
                goToStep(currentStep + 1);
            }
        }

        function prevStep() {
            if (currentStep > 1) {
                goToStep(currentStep - 1);
            }
        }

        // Toggle checkbox
        function toggleCheckbox(event, element) {
            event.preventDefault();
            event.stopPropagation();
            element.classList.toggle('checked');
            const input = element.querySelector('input');
            if (input) {
                input.checked = element.classList.contains('checked');
            }
        }

        // Toggle system section
        function toggleSystem(header) {
            const section = header.parentElement;
            section.classList.toggle('open');
        }

        // Copy result
        function copyResult() {
            const text = document.getElementById('resultText').innerText;
            navigator.clipboard.writeText(text).then(() => {
                alert('Lettre copi&eacute;e !');
            });
        }

        // Reset form
        function resetForm() {
            document.querySelectorAll('.form-input, .form-textarea').forEach(el => {
                el.value = '';
            });
            document.querySelectorAll('.form-select').forEach(el => {
                el.selectedIndex = 0;
            });
            document.querySelectorAll('.checkbox-item').forEach(el => {
                el.classList.remove('checked');
                const input = el.querySelector('input');
                if (input) input.checked = false;
            });
            document.getElementById('resultSection').classList.remove('active');
            goToStep(1);
        }

        // Show loading
        function showLoading() {
            document.getElementById('loadingOverlay').classList.add('active');
        }

        // Hide loading
        function hideLoading() {
            document.getElementById('loadingOverlay').classList.remove('active');
        }

        // Update summary when going to step 5
        function updateScoresSummary() {
            document.getElementById('summaryMNA').textContent = document.getElementById('mnaTotalDisplay').textContent;
            document.getElementById('summaryMoCA').textContent = document.getElementById('mocaTotalDisplay').textContent;
            document.getElementById('summaryGDS').textContent = document.getElementById('gdsTotalDisplay').textContent;
            document.getElementById('summaryADL').textContent = document.getElementById('adlTotalDisplay').textContent;
            document.getElementById('summaryIADL').textContent = document.getElementById('iadlTotalDisplay').textContent;
        }

        // Collect all form data
        function collectFormData() {
            const data = {
                // Identit√©
                nom: document.getElementById('patientNom')?.value || '',
                prenom: document.getElementById('patientPrenom')?.value || '',
                age: document.getElementById('patientAge')?.value || '',
                sexe: document.getElementById('patientSexe')?.value || '',
                dateEntree: document.getElementById('dateEntree')?.value || '',
                provenance: document.getElementById('provenance')?.value || '',
                motifHospitalisation: document.getElementById('motifHospitalisation')?.value || '',
                medecinTraitant: document.getElementById('medecinTraitant')?.value || '',
                antecedents: document.getElementById('antecedents')?.value || '',
                traitementHabituel: document.getElementById('traitementHabituel')?.value || '',

                // Anamn√®se
                anamneseSymptomes: [],
                anamneseRemarques: document.getElementById('anamneseRemarques')?.value || '',

                // Status
                constantes: {
                    taSystolique: document.getElementById('taSystolique')?.value || '',
                    taDiastolique: document.getElementById('taDiastolique')?.value || '',
                    fc: document.getElementById('fc')?.value || '',
                    spo2: document.getElementById('spo2')?.value || '',
                    temperature: document.getElementById('temperature')?.value || '',
                    gcs: document.getElementById('gcs')?.value || '',
                    poids: document.getElementById('poids')?.value || '',
                    taille: document.getElementById('taille')?.value || ''
                },
                statusAnomalies: [],
                statusDetails: {
                    general: document.getElementById('statusGeneralDetails')?.value || '',
                    cv: document.getElementById('statusCvDetails')?.value || '',
                    resp: document.getElementById('statusRespDetails')?.value || '',
                    dig: document.getElementById('statusDigDetails')?.value || '',
                    neuro: document.getElementById('statusNeuroDetails')?.value || '',
                    cut: document.getElementById('statusCutDetails')?.value || ''
                },
                statusRemarques: document.getElementById('statusRemarques')?.value || '',

                // Scores
                scores: {
                    mna: document.getElementById('mnaTotalDisplay')?.textContent || '--/14',
                    moca: document.getElementById('mocaTotalDisplay')?.textContent || '--/30',
                    gds: document.getElementById('gdsTotalDisplay')?.textContent || '--/4',
                    adl: document.getElementById('adlTotalDisplay')?.textContent || '--/6',
                    iadl: document.getElementById('iadlTotalDisplay')?.textContent || '--/8'
                },

                // Compl√©ments
                situationSociale: document.getElementById('situationSociale')?.value || '',
                modeVie: document.getElementById('modeVie')?.value || '',
                laboEntree: document.getElementById('laboEntree')?.value || '',
                examensComplementaires: document.getElementById('examensComplementaires')?.value || '',
                objectifsSejour: document.getElementById('objectifss√©jour')?.value || '',
                autresRemarques: document.getElementById('autresRemarques')?.value || ''
            };

            // Collect anamn√®se symptoms
            document.querySelectorAll('.checkbox-item.checked input[name^="anamnese_"]').forEach(input => {
                data.anamneseSymptomes.push(input.value);
            });

            // Collect status anomalies
            document.querySelectorAll('.checkbox-item.checked input[name^="status_"]').forEach(input => {
                data.statusAnomalies.push(input.value);
            });

            return data;
        }

        // Build prompt for Claude
        function buildPrompt(data) {
            const sexeLabel = data.sexe === 'M' ? 'Monsieur' : 'Madame';
            const provenanceLabel = {
                'domicile': 'du domicile',
                'urgences': 'des urgences',
                'transfert': 'd\'un autre service',
                'ems': 'd\'un EMS',
                'readaptation': 'd\'un centre de r√©adaptation'
            }[data.provenance] || '';

            let prompt = `R√©dige une lettre d'entr√©e g√©riatrique structur√©e pour ce patient.

## INFORMATIONS PATIENT
- Identit√©: ${sexeLabel} ${data.prenom} ${data.nom}, ${data.age} ans
- Date d'entr√©e: ${data.dateEntree}
- Provenance: ${provenanceLabel}
- Motif d'hospitalisation: ${data.motifHospitalisation}
- M√©decin traitant: ${data.medecinTraitant}
- Ant√©c√©dents: ${data.antecedents}
- Traitement habituel: ${data.traitementHabituel}

## ANAMN√àSE
Sympt√¥mes pr√©sents: ${data.anamneseSymptomes.length > 0 ? data.anamneseSymptomes.join(', ') : 'Aucun sympt√¥me particulier signal√©'}
${data.anamneseRemarques ? 'Remarques: ' + data.anamneseRemarques : ''}

## STATUS CLINIQUE √Ä L'ENTR√âE
Constantes: TA ${data.constantes.taSystolique}/${data.constantes.taDiastolique} mmHg, FC ${data.constantes.fc} bpm, SpO2 ${data.constantes.spo2}%, T¬∞ ${data.constantes.temperature}¬∞C, GCS ${data.constantes.gcs}/15
Poids: ${data.constantes.poids} kg, Taille: ${data.constantes.taille} cm
Anomalies √† l'examen: ${data.statusAnomalies.length > 0 ? data.statusAnomalies.join(', ') : 'Examen sans particularit√©'}
${data.statusDetails.general ? 'D√©tails √©tat g√©n√©ral: ' + data.statusDetails.general : ''}
${data.statusDetails.cv ? 'D√©tails CV: ' + data.statusDetails.cv : ''}
${data.statusDetails.resp ? 'D√©tails resp: ' + data.statusDetails.resp : ''}
${data.statusDetails.dig ? 'D√©tails dig: ' + data.statusDetails.dig : ''}
${data.statusDetails.neuro ? 'D√©tails neuro: ' + data.statusDetails.neuro : ''}
${data.statusDetails.cut ? 'D√©tails cutan√©: ' + data.statusDetails.cut : ''}
${data.statusRemarques ? 'Autres remarques cliniques: ' + data.statusRemarques : ''}

## √âVALUATION G√âRIATRIQUE
- Mini-MNA (nutrition): ${data.scores.mna}
- MoCA (cognition): ${data.scores.moca}
- Mini-GDS (d√©pression): ${data.scores.gds}
- ADL (autonomie de base): ${data.scores.adl}
- IADL (autonomie instrumentale): ${data.scores.iadl}

## INFORMATIONS COMPL√âMENTAIRES
${data.situationSociale ? 'Situation sociale: ' + data.situationSociale : ''}
${data.modeVie ? 'Mode de vie: ' + data.modeVie : ''}
${data.laboEntree ? 'Laboratoire d\'entr√©e: ' + data.laboEntree : ''}
${data.examensComplementaires ? 'Examens compl√©mentaires: ' + data.examensComplementaires : ''}
${data.objectifsSejour ? 'Objectifs du s√©jour: ' + data.objectifsSejour : ''}
${data.autresRemarques ? 'Autres remarques: ' + data.autresRemarques : ''}

## CONSIGNES DE R√âDACTION
1. Structure la lettre avec: En-t√™te, Motif d'admission, Anamn√®se, Examen clinique, √âvaluation g√©riatrique, Bilan paraclinique, Synth√®se et objectifs
2. Utilise un style m√©dical professionnel adapt√© √† la g√©riatrie
3. Interpr√®te les scores g√©riatriques et mentionne leur signification clinique
4. Propose des objectifs de prise en charge adapt√©s
5. Ne pas inventer d'informations non fournies`;

            return prompt;
        }

        // Generate letter with Claude API
        async function generateLetter() {
            // Use same API key as MediLetter
            const apiKey = localStorage.getItem('mediletter_apikey');

            if (!apiKey) {
                alert('Cl√© API non configur√©e. Veuillez d\'abord configurer votre cl√© API dans MediLetter.');
                return;
            }

            showLoading();

            try {
                const formData = collectFormData();
                const prompt = buildPrompt(formData);

                const response = await fetch('https://api.anthropic.com/v1/messages', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'x-api-key': apiKey,
                        'anthropic-version': '2023-06-01',
                        'anthropic-dangerous-direct-browser-access': 'true'
                    },
                    body: JSON.stringify({
                        model: 'claude-sonnet-4-20250514',
                        max_tokens: 4096,
                        messages: [{
                            role: 'user',
                            content: prompt
                        }]
                    })
                });

                if (!response.ok) {
                    throw new Error(`Erreur API: ${response.status}`);
                }

                const result = await response.json();
                const letterContent = result.content[0].text;

                document.getElementById('resultText').innerText = letterContent;
                document.getElementById('resultSection').classList.add('active');

                // Hide form steps
                document.querySelectorAll('.form-step').forEach(step => {
                    step.classList.remove('active');
                });

                // Mark all steps as completed
                document.querySelectorAll('.progress-step').forEach(step => {
                    step.classList.remove('active');
                    step.classList.add('completed');
                });

            } catch (error) {
                console.error('Erreur:', error);
                alert('Erreur lors de la g√©n√©ration: ' + error.message);
            } finally {
                hideLoading();
            }
        }


        // ==========================================
        // SCORE CALCULATIONS
        // ==========================================

        // Mini-MNA
        function calculateMNA() {
            const items = document.querySelectorAll('.mna-item');
            let total = 0;
            let answered = 0;

            items.forEach(item => {
                if (item.value !== '') {
                    total += parseInt(item.value);
                    answered++;
                }
            });

            const display = document.getElementById('mnaTotalDisplay');
            const interpretation = document.getElementById('mnaInterpretation');

            if (answered === 0) {
                display.textContent = '--/14';
                interpretation.textContent = '';
                interpretation.style.background = '';
                return;
            }

            display.textContent = total + '/14';

            if (answered === 6) {
                if (total >= 12) {
                    interpretation.textContent = '√âtat nutritionnel normal';
                    interpretation.style.background = 'var(--success-bg)';
                    interpretation.style.color = 'var(--success)';
                } else if (total >= 8) {
                    interpretation.textContent = 'Risque de malnutrition';
                    interpretation.style.background = 'var(--warning-bg)';
                    interpretation.style.color = 'var(--warning)';
                } else {
                    interpretation.textContent = 'Malnutrition av√©r√©e';
                    interpretation.style.background = 'var(--danger-bg)';
                    interpretation.style.color = 'var(--danger)';
                }
            } else {
                interpretation.textContent = 'Compl√©tez toutes les questions';
                interpretation.style.background = 'var(--bg-tertiary)';
                interpretation.style.color = 'var(--text-muted)';
            }
        }

        // MoCA
        function calculateMoCA() {
            const score = document.getElementById('mocaScore').value;
            const education = document.getElementById('mocaEducation').value;
            const display = document.getElementById('mocaTotalDisplay');
            const interpretation = document.getElementById('mocaInterpretation');

            if (score === '') {
                display.textContent = '--/30';
                interpretation.textContent = '';
                interpretation.style.background = '';
                return;
            }

            let total = parseInt(score);
            if (education === '1') {
                total = Math.min(30, total + 1);
            }

            display.textContent = total + '/30';

            if (total >= 26) {
                interpretation.textContent = 'Normal (‚â•26)';
                interpretation.style.background = 'var(--success-bg)';
                interpretation.style.color = 'var(--success)';
            } else if (total >= 18) {
                interpretation.textContent = 'Trouble cognitif l√©ger (18-25)';
                interpretation.style.background = 'var(--warning-bg)';
                interpretation.style.color = 'var(--warning)';
            } else {
                interpretation.textContent = 'Trouble cognitif mod√©r√© √† s√©v√®re (<18)';
                interpretation.style.background = 'var(--danger-bg)';
                interpretation.style.color = 'var(--danger)';
            }
        }

        // Mini-GDS
        function calculateGDS() {
            const items = document.querySelectorAll('.gds-item');
            let total = 0;
            let answered = 0;

            items.forEach(item => {
                if (item.value !== '') {
                    total += parseInt(item.value);
                    answered++;
                }
            });

            const display = document.getElementById('gdsTotalDisplay');
            const interpretation = document.getElementById('gdsInterpretation');

            if (answered === 0) {
                display.textContent = '--/4';
                interpretation.textContent = '';
                interpretation.style.background = '';
                return;
            }

            display.textContent = total + '/4';

            if (answered === 4) {
                if (total === 0) {
                    interpretation.textContent = 'Pas de d√©pression';
                    interpretation.style.background = 'var(--success-bg)';
                    interpretation.style.color = 'var(--success)';
                } else if (total === 1) {
                    interpretation.textContent = 'Tr√®s forte probabilit√© de d√©pression';
                    interpretation.style.background = 'var(--warning-bg)';
                    interpretation.style.color = 'var(--warning)';
                } else {
                    interpretation.textContent = 'D√©pression tr√®s probable (' + total + '/4)';
                    interpretation.style.background = 'var(--danger-bg)';
                    interpretation.style.color = 'var(--danger)';
                }
            } else {
                interpretation.textContent = 'Compl√©tez toutes les questions';
                interpretation.style.background = 'var(--bg-tertiary)';
                interpretation.style.color = 'var(--text-muted)';
            }
        }

        // ADL
        function calculateADL() {
            const items = document.querySelectorAll('.adl-item');
            let total = 0;
            let answered = 0;

            items.forEach(item => {
                if (item.value !== '') {
                    total += parseInt(item.value);
                    answered++;
                }
            });

            const display = document.getElementById('adlTotalDisplay');
            const interpretation = document.getElementById('adlInterpretation');

            if (answered === 0) {
                display.textContent = '--/6';
                interpretation.textContent = '';
                interpretation.style.background = '';
                return;
            }

            display.textContent = total + '/6';

            if (answered === 6) {
                if (total === 6) {
                    interpretation.textContent = 'Autonomie compl√®te';
                    interpretation.style.background = 'var(--success-bg)';
                    interpretation.style.color = 'var(--success)';
                } else if (total >= 4) {
                    interpretation.textContent = 'D√©pendance l√©g√®re';
                    interpretation.style.background = 'var(--warning-bg)';
                    interpretation.style.color = 'var(--warning)';
                } else if (total >= 2) {
                    interpretation.textContent = 'D√©pendance mod√©r√©e';
                    interpretation.style.background = 'var(--warning-bg)';
                    interpretation.style.color = 'var(--warning)';
                } else {
                    interpretation.textContent = 'D√©pendance s√©v√®re';
                    interpretation.style.background = 'var(--danger-bg)';
                    interpretation.style.color = 'var(--danger)';
                }
            } else {
                interpretation.textContent = 'Compl√©tez toutes les questions';
                interpretation.style.background = 'var(--bg-tertiary)';
                interpretation.style.color = 'var(--text-muted)';
            }
        }

        // IADL
        function calculateIADL() {
            const items = document.querySelectorAll('.iadl-item');
            let total = 0;
            let answered = 0;

            items.forEach(item => {
                if (item.value !== '') {
                    total += parseInt(item.value);
                    answered++;
                }
            });

            const display = document.getElementById('iadlTotalDisplay');
            const interpretation = document.getElementById('iadlInterpretation');

            if (answered === 0) {
                display.textContent = '--/8';
                interpretation.textContent = '';
                interpretation.style.background = '';
                return;
            }

            display.textContent = total + '/8';

            if (answered === 8) {
                if (total === 8) {
                    interpretation.textContent = 'Autonomie compl√®te';
                    interpretation.style.background = 'var(--success-bg)';
                    interpretation.style.color = 'var(--success)';
                } else if (total >= 5) {
                    interpretation.textContent = 'D√©pendance l√©g√®re';
                    interpretation.style.background = 'var(--warning-bg)';
                    interpretation.style.color = 'var(--warning)';
                } else if (total >= 2) {
                    interpretation.textContent = 'D√©pendance mod√©r√©e';
                    interpretation.style.background = 'var(--warning-bg)';
                    interpretation.style.color = 'var(--warning)';
                } else {
                    interpretation.textContent = 'D√©pendance s√©v√®re';
                    interpretation.style.background = 'var(--danger-bg)';
                    interpretation.style.color = 'var(--danger)';
                }
            } else {
                interpretation.textContent = 'Compl√©tez toutes les questions';
                interpretation.style.background = 'var(--bg-tertiary)';
                interpretation.style.color = 'var(--text-muted)';
            }
        }
    </script>
</body>
</html>
